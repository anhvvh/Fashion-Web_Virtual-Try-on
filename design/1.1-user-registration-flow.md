# 1.1 User Registration Flow

## Mô tả
Flow đăng ký tài khoản mới bằng email và mật khẩu.

## Flowchart

```mermaid
flowchart TD
    Start([User mở form đăng ký]) --> Input[User nhập email, password, confirm password]
    Input --> ValidateClient{Client validate<br/>sơ bộ}
    ValidateClient -->|Invalid| ShowError1[Hiển thị lỗi validation]
    ShowError1 --> Input
    ValidateClient -->|Valid| Submit[User submit form]
    Submit --> SendRequest[Gửi POST /api/auth/register]
    SendRequest --> ValidateServer{Server validate}
    ValidateServer -->|Email format sai| ReturnError1[Trả lỗi 400: Email không hợp lệ]
    ValidateServer -->|Password không đạt tiêu chí| ReturnError2[Trả lỗi 400: Mật khẩu không hợp lệ]
    ValidateServer -->|Confirm password không khớp| ReturnError3[Trả lỗi 400: Mật khẩu xác nhận không khớp]
    ValidateServer -->|Valid| CheckEmail{Kiểm tra email<br/>đã tồn tại?}
    CheckEmail -->|Email đã tồn tại| ReturnError4[Trả lỗi 409: Email đã được sử dụng]
    CheckEmail -->|Email chưa tồn tại| HashPassword[Hash password với bcrypt]
    HashPassword --> CreateProfile[Tạo record trong bảng profiles]
    CreateProfile -->|Lỗi DB| ReturnError5[Trả lỗi 500: Lỗi hệ thống]
    CreateProfile -->|Thành công| ReturnSuccess[Trả 201: Đăng ký thành công]
    ReturnError1 --> ShowError2[Hiển thị lỗi trên UI]
    ReturnError2 --> ShowError2
    ReturnError3 --> ShowError2
    ReturnError4 --> ShowError2
    ReturnError5 --> ShowError2
    ShowError2 --> Input
    ReturnSuccess --> ShowSuccess[Hiển thị thông báo thành công]
    ShowSuccess --> Redirect[Redirect đến trang login hoặc dashboard]
    Redirect --> End([Kết thúc])
```

## Luồng chính (Happy Path)
1. User mở form đăng ký
2. User nhập email, password, confirm password
3. Client validate sơ bộ (format email, độ dài password)
4. User submit form
5. Server validate dữ liệu
6. Server kiểm tra email chưa tồn tại
7. Server hash password
8. Server tạo profile mới
9. Trả về thông báo thành công
10. Redirect đến trang login hoặc dashboard

## Luồng lỗi
- Email format không hợp lệ → 400 Bad Request
- Password không đạt tiêu chí (tối thiểu 8 ký tự) → 400 Bad Request
- Confirm password không khớp → 400 Bad Request
- Email đã tồn tại → 409 Conflict
- Lỗi database → 500 Internal Server Error
- Lỗi mạng → Hiển thị thông báo thân thiện

## Validation Rules
- Email: định dạng hợp lệ, lowercase, unique
- Password: tối thiểu 8 ký tự, nên có chữ thường/hoa/số/ký tự đặc biệt
- Confirm password: phải khớp với password

